webpackJsonp([8],{"C/L3":function(t,e){},I2K0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),r=a.n(s),o=a("NYxO"),i=a("YRzF"),n={password:[{type:"string",required:!0,message:"请输入密码"}],oldPassword:[{type:"string",required:!0,message:"请输入旧密码"}],last_name:[{type:"string",required:!0,message:"请输入用户姓氏"}],first_name:[{type:"string",required:!0,message:"请输入用户名字"}]},l={name:"UserAdmin",props:["userID"],data:function(){var t=this;return{userData:{oldPassword:"",email:"",password:"",confirmPassword:"",last_name:"",first_name:""},defaultList:[],tempFileList:[],userAvatar:"",uploadFile:"",showUplaodAvatar:!1,userList:{},ruleCustom:r()({},n,{confirmPassword:[{validator:function(e,a,s){""===a?s(new Error("请再次输入密码")):a!==t.userData.password?s(new Error("两次密码不一致")):s()},trigger:"blur"}],email:[{type:"email",required:!0,validator:function(e,a,s){""===a.trim()||a.indexOf("@")<0?s(new Error("请输入合法用户邮箱")):t.userExists(a)?s(new Error("用户邮箱已经存在，请使用其他邮箱。")):s()},trigger:"blur"}]})}},computed:r()({},Object(o.c)(["appBodyHeight","userInfo"]),Object(o.c)("systemglobal",["createDialogShow"]),{containerHeight:function(){return this.appBodyHeight-70},routerName:function(){return this.$route.name}}),methods:r()({},Object(o.d)("systemglobal",["setCreateDialogShow"]),{updateProfiles:function(t){var e=this;this.$refs[t].validate(function(t){t&&e.$axios.post("/api/auth/user/"+e.userID,e.userData).then(function(t){e.$Message.success({content:"更新信息成功",duration:10,closable:!0})},function(t){e.$Message.error({content:"更新信息失败",duration:10,closable:!0})})})},changeAvatar:function(){this.showUplaodAvatar=!0},closeDialog:function(){this.showUplaodAvatar=!1,this.clearTempFiles()},changePassword:function(t){var e=this;this.$refs[t].validate(function(t){t&&e.$axios.put("/api/auth/user/"+e.userID,e.userData).then(function(t){1===t.data.result.code?e.$Message.success({content:t.data.result.message,duration:10,closable:!0}):e.$Message.error({content:t.data.result.message,duration:10,closable:!0})},function(t){e.$Message.error({content:"密码修改失败",duration:10,closable:!0})})})},onUpdateAvatar:function(){var t=this,e={uploadList:[this.uploadFile]};this.$axios.patch("/api/ucenter/profiles/update_avatar",e).then(function(e){t.clearTempFiles()},function(t){}),this.showUplaodAvatar=!1},clearTempFiles:function(){var t=this;this.$axios.delete("/api/ucenter/profiles/clear_tempfiles/"+this.tempFileList).then(function(e){t.tempFileList=[]},function(t){})},handleSuccess:function(t,e,a){e.url=t.result.url,e.id=t.result.file_id,this.userAvatar=e.url,this.uploadFile=e.id,this.tempFileList.push(e.id)},handleRemove:function(t,e){this.uploadList=e},handleFormatError:function(t){this.$Message.warning({content:"文件格式不正确,格式：'jpg','jpeg','png'",duration:10,closable:!0})},handleMaxSize:function(t){this.$Message.warning({content:"文件大小超过10M限制",duration:10,closable:!0})},getUserInfo:function(){var t=this;this.$axios.get("/api/auth/user/"+this.userID).then(function(e){t.userData=e.data.result,t.userData.oldPassword="",t.userAvatar=t.userData.avatar},function(t){})},userExists:function(t){for(var e=!1,a=0;a<this.userList.length;a++)t.trim()===this.userList[a].email&&parseInt(this.userID)!==this.userList[a].id&&(e=!0);return e},getUserList:function(){var t=this;this.$axios.get("/api/auth/users").then(function(e){t.userList=e.data.result},function(t){})}}),created:function(){this.getUserInfo(),this.getUserList()},mounted:function(){},watch:{},components:{ICol:i.a}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{style:"padding-top:16px;padding-left: 10px; height:"+t.containerHeight+"px;overflow-y:auto;overflow-x:hidden;"},[a("div",{staticClass:"info-body"},[a("Divider",{attrs:{orientation:"left"}},[t._v(t._s(t.userData.name))]),t._v(" "),a("div",{staticStyle:{height:"350px"}},[a("Form",{ref:"editAccount",attrs:{model:t.userData,"label-width":80,rules:t.ruleCustom}},[a("FormItem",{attrs:{label:"头像"}},[a("div",{staticClass:"cursor-hand",on:{click:t.changeAvatar}},[a("Avatar",{staticStyle:{width:"70px",height:"70px","border-radius":"35px"},attrs:{src:t.userAvatar}}),t._v(" "),a("Icon",{staticStyle:{"margin-top":"-50px"},attrs:{size:20,type:"ios-create-outline"}})],1)]),t._v(" "),a("FormItem",{attrs:{label:"邮箱",prop:"email"}},[a("Input",{attrs:{type:"email",placeholder:"用户邮箱"},model:{value:t.userData.email,callback:function(e){t.$set(t.userData,"email",e)},expression:"userData.email"}})],1),t._v(" "),a("FormItem",{attrs:{label:"姓氏",prop:"last_name"}},[a("Input",{attrs:{placeholder:"用户姓氏"},model:{value:t.userData.last_name,callback:function(e){t.$set(t.userData,"last_name",e)},expression:"userData.last_name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"名字",prop:"last_name"}},[a("Input",{attrs:{placeholder:"用户名字"},model:{value:t.userData.first_name,callback:function(e){t.$set(t.userData,"first_name",e)},expression:"userData.first_name"}})],1)],1),t._v(" "),a("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"success",shape:"circle"},on:{click:function(e){t.updateProfiles("editAccount")}}},[t._v("保存")])],1),t._v(" "),a("Divider",{attrs:{orientation:"left"}},[t._v("密码修改")]),t._v(" "),a("div",[a("Form",{ref:"resetPassword",attrs:{model:t.userData,"label-width":80,rules:t.ruleCustom}},[a("FormItem",{attrs:{label:"旧密码",prop:"oldPassword"}},[a("Input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.userData.oldPassword,callback:function(e){t.$set(t.userData,"oldPassword",e)},expression:"userData.oldPassword"}})],1),t._v(" "),a("FormItem",{attrs:{label:"新密码",prop:"password"}},[a("Input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.userData.password,callback:function(e){t.$set(t.userData,"password",e)},expression:"userData.password"}})],1),t._v(" "),a("FormItem",{attrs:{label:"确认新密码",prop:"confirmPassword"}},[a("Input",{attrs:{type:"password",placeholder:"确认密码"},model:{value:t.userData.confirmPassword,callback:function(e){t.$set(t.userData,"confirmPassword",e)},expression:"userData.confirmPassword"}})],1)],1),t._v(" "),a("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"error",shape:"circle"},on:{click:function(e){t.changePassword("resetPassword")}}},[t._v("修改")])],1),t._v(" "),a("Modal",{attrs:{value:t.showUplaodAvatar,title:"上传头像","mask-closable":!1},on:{"on-cancel":t.closeDialog}},[a("div",{staticStyle:{"margin-bottom":"10px","margin-left":"10px"}},[a("img",{staticStyle:{width:"60px",height:"60px","border-radius":"30px"},attrs:{src:t.userAvatar}})]),t._v(" "),a("Upload",{ref:"upload",attrs:{type:"drag",paste:"","show-upload-list":!1,action:"/api/ucenter/attachment/upload","on-success":t.handleSuccess,"on-remove":t.handleRemove,format:[],"max-size":10240,"default-file-list":t.defaultList,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),t._v(" "),a("p",[t._v("点击，拖拽，粘贴上传附件")])],1)]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",size:"default",shape:"circle"},on:{click:t.onUpdateAvatar}},[t._v("确认更新")])],1)],1)],1)])},staticRenderFns:[]};var c=a("VU/8")(l,u,!1,function(t){a("C/L3")},"data-v-6c320a23",null);e.default=c.exports}});
//# sourceMappingURL=8.5d19c55980edbc64d3b6.js.map