webpackJsonp([28],{"0Zqs":function(t,e){},pCoK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Dd8w"),o=a.n(n),s=a("NYxO"),r=a("5MND"),i={Name:[{type:"string",required:!0,min:1,max:20,message:"Agent标题长度必须在1-20个字符之间！",trigger:"blur"}],AgentWorkSpace:[{type:"string",required:!0,message:"任务工作目录不能为空"}],BuildToolsDir:[{type:"string",required:!0,message:"工具目录不能为空"}]},l={name:"CIAgent",data:function(){return{agents:[],showAgentDetail:!1,formItem:{Name:"",AgentWorkSpace:"",AgentTags:[],Executors:1,BuildToolsDir:""},editItem:{Name:"",AgentWorkSpace:"",AgentTags:[],Executors:1,BuildToolsDir:""},agentTagList:[],ruleCustom:o()({},i)}},computed:o()({},Object(s.c)(["appBodyHeight","userInfo"]),Object(s.c)("ciglobal",["ciNewObject"]),{containerHeight:function(){return this.appBodyHeight},modalHeight:function(){return this.appBodyHeight-200}}),methods:o()({},Object(s.d)("ciglobal",["setCINewObject"]),{onCloseDetailPanel:function(){this.showAgentDetail=!1},showAgentForm:function(t){this.showAgentDetail=!0,this.editItem=this.findAgent(t).entry},findAgent:function(t){for(var e={index:-1,entry:null},a=0;a<this.agents.length;a++)if(t===this.agents[a].id){e.entry=this.agents[a],e.index=a;break}return e},addAgent:function(t){var e=this;this.$refs[t].validate(function(a){if(a){e.setCINewObject(!1);e.$axios.post("/api/common/agents",e.formItem).then(function(t){e.agents.push(t.data.result),e.$Message.success({content:"Agent添加成功",duration:10})},function(t){e.setCINewObject(!1),e.$Message.error({content:"Agent添加失败，请联系管理员或者重试",duration:10})}),e.$refs[t].reset()}})},editAgent:function(t){var e=this;this.$refs[t].validate(function(a){if(a){e.setCINewObject(!1);e.$axios.put("/api/common/agent/"+e.editItem.id,e.editItem).then(function(t){e.getAgents(),e.$Message.success({content:"Agent保存成功",duration:10})},function(t){e.$Message.error({content:"Agent保存失败，请联系管理员或者重试",duration:10})}),e.$refs[t].reset()}})},cancel:function(){this.setCINewObject(!1)},getAgentTags:function(){var t=this;this.$axios.get("/api/project/tags").then(function(e){t.agentTagList=e.data.result},function(t){})},getAgents:function(){var t=this;this.$axios.get("/api/common/agents").then(function(e){t.agents=e.data.result},function(t){})},setAgentTag:function(t){},deleteAgent:function(t){}}),created:function(){this.getAgentTags(),this.getAgents(),this.loadProjectInfo()},mounted:function(){},watch:{},components:{labelEditorInput:r.a}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{style:"overflow-y:auto;height:"+t.containerHeight+"px;"},[a("div",{staticStyle:{"padding-top":"16px"}},[t._l(t.agents,function(e){return a("Card",{key:e.id,staticClass:"member-card cursor-hand",attrs:{bordered:!1,"dis-hover":""}},[a("Row",[a("i-col",{attrs:{xl:20,lg:20,md:18,sm:12}},[a("Row",[a("i-col",{attrs:{span:"4"}},[a("span",{staticStyle:{"font-weight":"bold",display:"inline-block"}},[a("span",{staticStyle:{"padding-right":"20px"}},[t._v(t._s(e.id))]),t._v(" "),a("span",{staticStyle:{"text-decoration":"underline"},on:{click:function(a){t.showAgentForm(e.id)}}},[t._v(t._s(e.Name))])])]),t._v(" "),a("i-col",{attrs:{span:"20"}},[a("span",{staticStyle:{"margin-left":"15px"}},[a("span",{staticStyle:{display:"inline-block"}},t._l(e.TagFormat,function(e){return a("Tag",{key:e.id,staticClass:"member-tag",attrs:{color:e.TagColor}},[t._v(t._s(e.TagName))])}))])])],1)],1),t._v(" "),a("i-col",{attrs:{xl:4,lg:4,md:8,sm:12}},[t.projectPermision>3?a("span",[a("Dropdown",{attrs:{transfer:""},on:{"on-click":t.deleteAgent}},[a("a",{staticStyle:{color:"inherit"},attrs:{href:"javascript:void(0)"}},[a("span",[a("Icon",{attrs:{size:24,type:"ios-more"}})],1)]),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:t.member.id+":"+e.name}},[a("Icon",{attrs:{type:"ios-trash-outline"}}),t._v(" "),a("span",[t._v("删除")])],1)],1)],1)],1):t._e()])],1)],1)}),t._v(" "),a("Modal",{attrs:{value:t.ciNewObject,title:"添加Agent","mask-closable":!1,width:600,styles:{bottom:"20px",top:"50px"}},on:{"on-cancel":t.cancel}},[a("div",{style:"height:"+t.modalHeight+"px;overflow-y: scroll;overflow-x: hidden"},[a("Form",{ref:"ciAgentCreate",attrs:{model:t.formItem,"label-width":80,rules:t.ruleCustom}},[a("FormItem",{attrs:{label:"名称",prop:"Name"}},[a("Input",{attrs:{placeholder:"Agent名称20个字符以内！"},model:{value:t.formItem.Name,callback:function(e){t.$set(t.formItem,"Name",e)},expression:"formItem.Name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"标签",prop:"AgentTags"}},[a("Select",{attrs:{multiple:"",placeholder:"为Agent添加标签"},on:{"on-change":t.onProjectChange},model:{value:t.formItem.AgentTags,callback:function(e){t.$set(t.formItem,"AgentTags",e)},expression:"formItem.AgentTags"}},t._l(t.agentTagList,function(e){return a("Option",{key:e.id,attrs:{value:e.id,label:e.TagName}},[a("span",{staticStyle:{"margin-right":"10px"}},[a("Avatar",{style:{background:e.TagColor},attrs:{shape:"square",size:"small"}})],1),t._v(" "),a("span",[t._v(t._s(e.TagName))])])}))],1),t._v(" "),a("FormItem",{attrs:{label:"工作目录",prop:"AgentWorkSpace"}},[a("Input",{attrs:{placeholder:"任务工作目录"},model:{value:t.formItem.AgentWorkSpace,callback:function(e){t.$set(t.formItem,"AgentWorkSpace",e)},expression:"formItem.AgentWorkSpace"}})],1),t._v(" "),a("FormItem",{attrs:{label:"执行器数量",prop:"Executors"}},[a("InputNumber",{attrs:{max:20,min:1,step:1},model:{value:t.formItem.Executors,callback:function(e){t.$set(t.formItem,"Executors",e)},expression:"formItem.Executors"}})],1),t._v(" "),a("FormItem",{attrs:{label:"工具目录",prop:"BuildToolsDir"}},[a("Input",{attrs:{placeholder:"Agent上存放通用工具目录"},model:{value:t.formItem.BuildToolsDir,callback:function(e){t.$set(t.formItem,"BuildToolsDir",e)},expression:"formItem.BuildToolsDir"}})],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticStyle:{width:"80px",height:"30px"},attrs:{type:"success",shape:"circle"},on:{click:function(e){t.addAgent("ciAgentCreate")}}},[t._v("添加\n        ")]),t._v(" "),a("Button",{staticStyle:{width:"80px",height:"30px"},attrs:{type:"default",shape:"circle"},on:{click:t.cancel}},[t._v("取消")])],1)])],2),t._v(" "),a("Drawer",{attrs:{value:t.showAgentDetail,"class-name":"fdsfds",inner:!0,transfer:!1,width:40,mask:!1},on:{"on-close":t.onCloseDetailPanel}},[a("div",{attrs:{slot:""},slot:"default"}),t._v(" "),a("Form",{ref:"editAgent",attrs:{model:t.editItem,"label-width":80,rules:t.ruleCustom}},[a("FormItem",{attrs:{label:"名称",prop:"Name"}},[a("Input",{attrs:{placeholder:"Agent名称20个字符以内！"},model:{value:t.editItem.Name,callback:function(e){t.$set(t.editItem,"Name",e)},expression:"editItem.Name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"标签",prop:"AgentTags"}},[a("Select",{attrs:{multiple:"",placeholder:"为Agent添加标签"},on:{"on-change":t.onProjectChange},model:{value:t.editItem.AgentTags,callback:function(e){t.$set(t.editItem,"AgentTags",e)},expression:"editItem.AgentTags"}},t._l(t.agentTagList,function(e){return a("Option",{key:e.id,attrs:{value:e.id,label:e.TagName}},[a("span",{staticStyle:{"margin-right":"10px"}},[a("Avatar",{style:{background:e.TagColor},attrs:{shape:"square",size:"small"}})],1),t._v(" "),a("span",[t._v(t._s(e.TagName))])])}))],1),t._v(" "),a("FormItem",{attrs:{label:"工作目录",prop:"AgentWorkSpace"}},[a("Input",{attrs:{placeholder:"任务工作目录"},model:{value:t.editItem.AgentWorkSpace,callback:function(e){t.$set(t.editItem,"AgentWorkSpace",e)},expression:"editItem.AgentWorkSpace"}})],1),t._v(" "),a("FormItem",{attrs:{label:"执行器数量",prop:"Executors"}},[a("InputNumber",{attrs:{max:20,min:1,step:1},model:{value:t.editItem.Executors,callback:function(e){t.$set(t.editItem,"Executors",e)},expression:"editItem.Executors"}})],1),t._v(" "),a("FormItem",{attrs:{label:"工具目录",prop:"BuildToolsDir"}},[a("Input",{attrs:{placeholder:"Agent上存放通用工具目录"},model:{value:t.editItem.BuildToolsDir,callback:function(e){t.$set(t.editItem,"BuildToolsDir",e)},expression:"editItem.BuildToolsDir"}})],1)],1),t._v(" "),a("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"success",shape:"circle"},on:{click:function(e){t.editAgent("editAgent")}}},[t._v("保存")])],1)],1)},staticRenderFns:[]};var m=a("VU/8")(l,c,!1,function(t){a("0Zqs")},"data-v-11f023c4",null);e.default=m.exports}});
//# sourceMappingURL=28.95350a28a3730bdcd2ee.js.map