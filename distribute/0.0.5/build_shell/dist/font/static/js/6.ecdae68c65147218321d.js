webpackJsonp([6],{TqnM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s("Dd8w"),a=s.n(r),o=s("NYxO"),i=(s("5MND"),s("YRzF")),n={name:"UserList",props:["users"],data:function(){return{userList:[],selectedUser:0,showLoading:!0}},computed:a()({},Object(o.c)(["appBodyHeight","userInfo"]),Object(o.c)("systemglobal",["systemAdminearchKey"]),{containerHeight:function(){return this.appBodyHeight},routerName:function(){return this.$route.name}}),methods:a()({},Object(o.d)("systemglobal",["setCreateDialogShow"]),Object(o.d)("user",["setShowUserDetail"]),{deleteUser:function(t){var e=this,s=t.split(":");this.$Modal.confirm({title:"删除确认",content:"您即将删除用户["+s[1]+"]",onOk:function(){for(var t=0;t<e.userList.length;t++)if(e.userList[t].id===parseInt(s[0])){e.userList.splice(t,1);break}e.$axios.delete("/api/auth/user/"+s[0]).then(function(t){e.$Message.success({content:"用户已经成功移除",duration:10,closable:!0})},function(t){e.$Message.error({content:"移除用户失败",duration:10,closable:!0})})}})},showUserDetail:function(t){this.$emit("on-selectUser",t),this.selectedUser=parseInt(t)},selectedUserClass:function(t){return this.selectedUser===t?"selectedUser":""}}),created:function(){this.userList=this.users},mounted:function(){},watch:{users:function(){this.userList=this.users,this.showLoading=!1},systemAdminearchKey:function(t){if(this.userList=[],""===t.trim())this.userList=this.users;else for(var e=0;e<this.users.length;e++)(this.users[e].name.indexOf(t)>-1||this.users[e].email.indexOf(t)>-1)&&this.userList.push(this.users[e])}},components:{ICol:i.a}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{style:"padding-top:16px;padding-left: 10px; height:"+t.containerHeight+"px;overflow-y:auto;overflow-x:hidden;"},[t._l(t.userList,function(e){return s("Card",{key:e.id,class:"member-card cursor-hand "+t.selectedUserClass(e.id),attrs:{bordered:!1,"dis-hover":""}},[s("Row",[s("i-col",{attrs:{xl:16,lg:16,md:16,sm:16}},[s("span",{staticStyle:{"font-weight":"bold"}},["A"===e.system_role_label?s("span",{staticStyle:{"margin-right":"0px",width:"50px",display:"inline-block"}},[s("Tooltip",{attrs:{content:"Admin用户"}},[s("Tag",{staticClass:"member-tag",attrs:{color:"success"}},[t._v("A")])],1)],1):t._e(),t._v(" "),"M"===e.system_role_label?s("span",{staticStyle:{"margin-right":"0px",width:"50px",display:"inline-block"}},[s("Tooltip",{attrs:{content:"Manager用户"}},[s("Tag",{staticClass:"member-tag",attrs:{color:"success"}},[t._v("M")])],1)],1):t._e(),t._v(" "),"U"===e.system_role_label?s("span",{staticStyle:{"margin-right":"0px",width:"50px",display:"inline-block"}}):t._e(),t._v(" "),s("img",{staticClass:"member-avatar",attrs:{src:e.avatar}}),t._v(" "),s("span",{staticStyle:{"text-decoration":"underline"},on:{click:function(s){t.showUserDetail(e.id)}}},[t._v(t._s(e.last_name)+t._s(e.first_name))]),t._v(" "),t.userInfo.id===e.id?s("span",{staticStyle:{"margin-left":"15px"}},[s("Tag",{staticClass:"member-tag",attrs:{color:"success"}},[t._v("It's you!")])],1):t._e()])]),t._v(" "),s("i-col",{attrs:{xl:4,lg:4,md:4,sm:4}},[s("span",{staticStyle:{"margin-left":"15px"}},[s("span",{staticStyle:{width:"60px",display:"inline-block"}},[s("Icon",{attrs:{type:"ios-mail-outline"}}),t._v(" "+t._s(e.email)+"\n            ")],1)])]),t._v(" "),s("i-col",{attrs:{xl:4,lg:4,md:4,sm:4}},[s("span",[s("Dropdown",{attrs:{transfer:""},on:{"on-click":t.deleteUser}},[s("a",{staticStyle:{color:"inherit"},attrs:{href:"javascript:void(0)"}},[s("span",[s("Icon",{attrs:{size:24,type:"ios-more"}})],1)]),t._v(" "),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[s("DropdownItem",{attrs:{name:e.id+":"+e.last_name+e.first_name}},[s("Icon",{attrs:{type:"ios-trash-outline"}}),t._v(" "),s("span",[t._v("删除")])],1)],1)],1)],1)])],1)],1)}),t._v(" "),t.showLoading?s("Spin",{attrs:{fix:"",size:"large"}}):t._e()],2)},staticRenderFns:[]};var c=s("VU/8")(n,l,!1,function(t){s("qQos")},"data-v-0a33bfed",null).exports,u={name:"UserGroup",props:["groups"],data:function(){return{userGroups:[]}},computed:a()({},Object(o.c)(["appBodyHeight","userInfo"]),Object(o.c)("systemglobal",["createDialogShow"]),{containerHeight:function(){return this.appBodyHeight-110},routerName:function(){return this.$route.name}}),methods:a()({},Object(o.d)("systemglobal",["setCreateDialogShow"])),created:function(){this.userGroups=this.groups},mounted:function(){},watch:{groups:function(){this.userGroups=this.groups}},components:{ICol:i.a}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",t._l(t.userGroups,function(e){return s("Card",{key:e.id,staticClass:"member-card cursor-hand",attrs:{bordered:!1,"dis-hover":""}},[s("Row",[s("i-col",{attrs:{xl:16,lg:16,md:16,sm:16}},[s("span",{staticStyle:{"font-weight":"bold"}},[s("img",{staticClass:"member-avatar",attrs:{src:e.avatar}}),t._v(" "),s("span",[t._v(t._s(e.last_name)+t._s(e.first_name))]),t._v(" "),t.userInfo.id===e.id?s("span",{staticStyle:{"margin-left":"15px"}},[s("Tag",{staticClass:"member-tag",attrs:{color:"success"}},[t._v("It's you!")])],1):t._e()])]),t._v(" "),s("i-col",{attrs:{xl:4,lg:4,md:4,sm:4}},[s("span",{staticStyle:{"margin-left":"15px"}},[s("span",{staticStyle:{width:"60px",display:"inline-block"}})])]),t._v(" "),s("i-col",{attrs:{xl:4,lg:4,md:4,sm:4}},[s("span",[s("Dropdown",{attrs:{transfer:""},on:{"on-click":t.deleteUser}},[s("a",{staticStyle:{color:"inherit"},attrs:{href:"javascript:void(0)"}},[s("span",[s("Icon",{attrs:{size:24,type:"ios-more"}})],1)]),t._v(" "),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[s("DropdownItem",{attrs:{name:e.id+":"+e.last_name+e.first_name}},[s("Icon",{attrs:{type:"ios-trash-outline"}}),t._v(" "),s("span",[t._v("删除")])],1)],1)],1)],1)])],1)],1)}))},staticRenderFns:[]};var m=s("VU/8")(u,d,!1,function(t){s("grds")},"data-v-6b7e1afd",null).exports,p={password:[{type:"string",required:!0,message:"请输入密码"}],email:[{type:"email",required:!0,message:"请输入邮箱"}],last_name:[{type:"string",required:!0,message:"请输入用户姓氏"}],first_name:[{type:"string",required:!0,message:"请输入用户名字"}]},h={name:"UserDetail",props:["userID","userList"],data:function(){var t=this;return{userData:{},systemRole:0,ruleCustom:a()({},p,{confirmPassword:[{validator:function(e,s,r){""===s?r(new Error("请再次输入密码")):s!==t.userData.password?r(new Error("两次密码不一致")):r()},trigger:"blur"}],email:[{type:"email",required:!0,validator:function(e,s,r){""===s.trim()||s.indexOf("@")<0?r(new Error("请输入合法用户邮箱")):t.userExists(s)?r(new Error("用户邮箱已经存在，请使用其他邮箱。")):r()},trigger:"blur"}]})}},computed:a()({},Object(o.c)(["appBodyHeight","userInfo"]),Object(o.c)("systemglobal",["createDialogShow"]),{containerHeight:function(){return this.appBodyHeight-70},routerName:function(){return this.$route.name}}),methods:a()({},Object(o.d)("systemglobal",["setCreateDialogShow"]),{updateProfiles:function(t){var e=this;this.$refs[t].validate(function(t){t&&e.$axios.post("/api/auth/user/"+e.userID,e.userData).then(function(t){e.$Message.success({content:"更新信息成功",duration:10,closable:!0})},function(t){e.$Message.error({content:"更新信息失败",duration:10,closable:!0})})})},resetPassword:function(t){var e=this;this.$refs[t].validate(function(t){t&&(console.log(e.userData),e.$axios.put("/api/auth/user/"+e.userID,e.userData).then(function(t){e.$Message.success({content:"重置密码成功",duration:10,closable:!0})},function(t){e.$Message.error({content:"重置密码失败",duration:10,closable:!0})}))})},updateUserGroup:function(){var t=this;console.log(this.systemRole);var e={userGroup:this.systemRole};this.$axios.patch("/api/auth/user/"+this.userID,e).then(function(e){t.$Message.success({content:"用户角色修改成功",duration:10,closable:!0})},function(e){t.$Message.error({content:"用户角色修改失败",duration:10,closable:!0})})},userExists:function(t){for(var e=!1,s=0;s<this.userList.length;s++)t.trim()===this.userList[s].email&&parseInt(this.userID)!==this.userList[s].id&&(e=!0);return e},getUserInfo:function(t){var e=this;this.$axios.get("/api/auth/user/"+t).then(function(t){e.userData=t.data.result,e.systemRole=t.data.result.groups[0].id},function(t){})}}),created:function(){this.getUserInfo(this.userID)},mounted:function(){},watch:{userID:function(t){this.getUserInfo(t)}},components:{ICol:i.a}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{style:"padding-top:16px;padding-left: 10px; height:"+t.containerHeight+"px;overflow-y:auto;overflow-x:hidden;"},[s("Card",{attrs:{bordered:!1,"dis-hover":""}},[s("div",{staticClass:"panel-title"},[s("span",[t._v("修改账号：")]),t._v(" "),s("span",[t._v(t._s(t.userData.name))])]),t._v(" "),s("Divider",{staticClass:"divider"}),t._v(" "),s("div",{staticStyle:{height:"260px"}},[s("Form",{ref:"editAccount",attrs:{model:t.userData,"label-width":80,rules:t.ruleCustom}},[s("FormItem",{attrs:{label:"邮箱",prop:"email"}},[s("Input",{attrs:{type:"email",placeholder:"用户邮箱"},model:{value:t.userData.email,callback:function(e){t.$set(t.userData,"email",e)},expression:"userData.email"}})],1),t._v(" "),s("FormItem",{attrs:{label:"姓氏",prop:"last_name"}},[s("Input",{attrs:{placeholder:"用户姓氏"},model:{value:t.userData.last_name,callback:function(e){t.$set(t.userData,"last_name",e)},expression:"userData.last_name"}})],1),t._v(" "),s("FormItem",{attrs:{label:"名字",prop:"first_name"}},[s("Input",{attrs:{placeholder:"用户名字"},model:{value:t.userData.first_name,callback:function(e){t.$set(t.userData,"first_name",e)},expression:"userData.first_name"}})],1)],1),t._v(" "),s("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"success",shape:"circle"},on:{click:function(e){t.updateProfiles("editAccount")}}},[t._v("保存")])],1),t._v(" "),"A"===t.userData.system_role_label?s("div",{staticClass:"panel-title"},[s("span",[t._v("权限设置：")])]):t._e(),t._v(" "),"A"===t.userData.system_role_label?s("Divider",{staticClass:"divider"}):t._e(),t._v(" "),"A"===t.userData.system_role_label?s("div",{staticStyle:{"margin-bottom":"60px"}},[s("div",{staticStyle:{"margin-bottom":"20px","padding-left":"80px"}},[s("RadioGroup",{attrs:{vertical:""},model:{value:t.systemRole,callback:function(e){t.systemRole=e},expression:"systemRole"}},[s("Radio",{attrs:{label:27}},[s("Icon",{attrs:{type:"locked",size:20}}),t._v(" "),s("span",[t._v("Admin")]),t._v(" "),s("span",{staticStyle:{color:"#737373","padding-left":"20px"}},[t._v("系统管理员组，拥有所有权限.")])],1),t._v(" "),s("Radio",{attrs:{label:28}},[s("Icon",{attrs:{type:"contrast",size:20}}),t._v(" "),s("span",[t._v("Manager")]),t._v(" "),s("span",{staticStyle:{color:"#737373","padding-left":"20px"}},[t._v("管理员组，拥有除创建用户组以外的所有权限。")])],1),t._v(" "),s("Radio",{attrs:{label:29}},[s("Icon",{attrs:{type:"ios-world",size:20}}),t._v(" "),s("span",[t._v("User")]),t._v(" "),s("span",{staticStyle:{color:"#737373","padding-left":"20px"}},[t._v("项目对所有人员可见")])],1)],1)],1),t._v(" "),s("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"error",shape:"circle"},on:{click:t.updateUserGroup}},[t._v("保存")])],1):t._e(),t._v(" "),s("div",{staticClass:"panel-title"},[s("span",[t._v("密码重置：")])]),t._v(" "),s("Divider",{staticClass:"divider"}),t._v(" "),s("div",[s("Form",{ref:"resetPassword",attrs:{model:t.userData,"label-width":80,rules:t.ruleCustom}},[s("FormItem",{attrs:{label:"新密码",prop:"password"}},[s("Input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.userData.password,callback:function(e){t.$set(t.userData,"password",e)},expression:"userData.password"}})],1),t._v(" "),s("FormItem",{attrs:{label:"确认新密码",prop:"confirmPassword"}},[s("Input",{attrs:{type:"password",placeholder:"确认密码"},model:{value:t.userData.confirmPassword,callback:function(e){t.$set(t.userData,"confirmPassword",e)},expression:"userData.confirmPassword"}})],1)],1),t._v(" "),s("Button",{staticStyle:{width:"80px",height:"30px","margin-left":"30px"},attrs:{type:"error",shape:"circle"},on:{click:function(e){t.resetPassword("resetPassword")}}},[t._v("重置")])],1)],1)],1)},staticRenderFns:[]};var v=s("VU/8")(h,f,!1,function(t){s("jGKx")},"data-v-33240ba8",null).exports,_={name:"UserAdmin",props:[],data:function(){var t=this;return{userList:[],groups:[],showUserDetail:!1,selectedUser:0,formItem:{email:"",password:"",confirmPassword:"",last_name:"",first_name:""},ruleCustom:a()({},p,{confirmPassword:[{validator:function(e,s,r){""===s?r(new Error("请再次输入密码")):s!==t.formItem.password?r(new Error("两次密码不一致")):r()},trigger:"blur"}],email:[{type:"email",required:!0,validator:function(e,s,r){""===s.trim()||s.indexOf("@")<0?r(new Error("请输入合法用户邮箱")):t.userExists(s)?r(new Error("用户邮箱已经存在，请使用其他邮箱。")):r()},trigger:"blur"}]})}},computed:a()({},Object(o.c)(["appBodyHeight","userInfo"]),Object(o.c)("systemglobal",["createDialogShow"]),{containerHeight:function(){return this.appBodyHeight},routerName:function(){return this.$route.name}}),methods:a()({},Object(o.d)("systemglobal",["setCreateDialogShow"]),{cancel:function(){this.setCreateDialogShow(!1)},addUser:function(){var t=this;this.$axios.post("/api/auth/users",this.formItem).then(function(e){t.userList.push(e.data.result),t.$Message.success({content:"成员用户成功",duration:10,closable:!0})},function(e){t.$Message.error({content:"用户添加失败",duration:10,closable:!0})}),this.setCreateDialogShow(!1)},onSelectUser:function(t){this.selectedUser=t,this.showUserDetail=!0},onCloseDetailPanel:function(){this.showUserDetail=!1,this.selectedUser=0},userExists:function(t){for(var e=!1,s=0;s<this.userList.length;s++)t.trim()===this.userList[s].email&&(e=!0);return e},getUserList:function(){var t=this;this.$axios.get("/api/auth/users").then(function(e){t.userList=e.data.result},function(t){})},onModalStatusChange:function(){this.initFormItem()},initFormItem:function(){this.formItem={email:"",password:"",confirmPassword:"",last_name:"",first_name:""}}}),created:function(){this.getUserList()},mounted:function(){},watch:{},components:{ICol:i.a,UserList:c,UserGroup:m,UserDetail:v}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Row",[s("i-col",{attrs:{lg:3,sm:6,xs:8}},[s("Card",{attrs:{title:"管理",icon:"ios-options",padding:16,shadow:""}},[s("CellGroup",[s("Cell",{attrs:{title:"用户",selected:"systemAdminUser"===t.routerName,to:"/system/user"}},[s("Icon",{attrs:{slot:"icon",type:"ios-person",size:20},slot:"icon"})],1)],1)],1)],1),t._v(" "),s("i-col",{attrs:{lg:21,sm:18,xs:16}},["systemAdminUser"===t.routerName?s("user-list",{attrs:{users:t.userList},on:{"on-selectUser":t.onSelectUser}}):t._e(),t._v(" "),"systemAdminUserGroup"===t.routerName?s("user-group",{attrs:{groups:t.groups}}):t._e()],1)],1),t._v(" "),s("Modal",{attrs:{value:t.createDialogShow,title:"添加用户",width:600,styles:{bottom:"20px",top:"50px"}},on:{"on-visible-change":t.onModalStatusChange,"on-cancel":t.cancel}},[s("div",[s("Form",{ref:"createAccount",attrs:{model:t.formItem,"label-width":80,rules:t.ruleCustom}},[s("FormItem",{attrs:{label:"邮箱",prop:"email"}},[s("Input",{attrs:{type:"email",placeholder:"用户邮箱"},model:{value:t.formItem.email,callback:function(e){t.$set(t.formItem,"email",e)},expression:"formItem.email"}})],1),t._v(" "),s("FormItem",{attrs:{label:"密码",prop:"password"}},[s("Input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.formItem.password,callback:function(e){t.$set(t.formItem,"password",e)},expression:"formItem.password"}})],1),t._v(" "),s("FormItem",{attrs:{label:"确认密码",prop:"confirmPassword"}},[s("Input",{attrs:{type:"password",placeholder:"确认密码"},model:{value:t.formItem.confirmPassword,callback:function(e){t.$set(t.formItem,"confirmPassword",e)},expression:"formItem.confirmPassword"}})],1),t._v(" "),s("FormItem",{attrs:{label:"姓氏",prop:"last_name"}},[s("Input",{attrs:{placeholder:"用户姓氏"},model:{value:t.formItem.last_name,callback:function(e){t.$set(t.formItem,"last_name",e)},expression:"formItem.last_name"}})],1),t._v(" "),s("FormItem",{attrs:{label:"名字",prop:"last_name"}},[s("Input",{attrs:{placeholder:"用户名字"},model:{value:t.formItem.first_name,callback:function(e){t.$set(t.formItem,"first_name",e)},expression:"formItem.first_name"}})],1)],1)],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{staticStyle:{width:"80px",height:"30px"},attrs:{type:"success",shape:"circle"},on:{click:t.addUser}},[t._v("添加\n      ")]),t._v(" "),s("Button",{staticStyle:{width:"80px",height:"30px"},attrs:{type:"default",shape:"circle"},on:{click:t.cancel}},[t._v("取消")])],1)]),t._v(" "),s("Drawer",{attrs:{value:t.showUserDetail,inner:!0,transfer:!1,width:50,mask:!1},on:{"on-close":t.onCloseDetailPanel}},[s("div",{attrs:{slot:""},slot:"default"}),t._v(" "),s("user-detail",{attrs:{userID:t.selectedUser,userList:t.userList}})],1)],1)},staticRenderFns:[]};var y=s("VU/8")(_,g,!1,function(t){s("XE2x")},"data-v-01b78f28",null);e.default=y.exports},XE2x:function(t,e){},grds:function(t,e){},jGKx:function(t,e){},qQos:function(t,e){}});
//# sourceMappingURL=6.ecdae68c65147218321d.js.map